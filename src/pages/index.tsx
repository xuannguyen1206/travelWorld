import { gql } from '@apollo/client';
import client from '../lib/apollo';
import type { NextPage } from 'next'
import Head from 'next/head'
import { useEffect, useState } from 'react';
import Navbar from '../components/navbar';
import ImageSlider from '../components/imageSlider';
import styles from '../styles/Home.module.scss';

interface homeProps {
  countryData: [countryData] 
}
interface countryData {
  name: string
  picture: HomePicture 
}

interface HomePicture{
  portrait: Picture
  landscape: Picture
}
interface Picture {
  link: string
}

const Home: NextPage<homeProps> = ( { countryData }) => { 
  const [currentSlide,setCurrentSlide] = useState<number>(0);
  const [currentCountry,setCurrentCountry] = useState<string>(countryData[0].name);
  const slides: Array<string> = [];
  countryData.map((country) => slides.push(country.picture.portrait.link));
  function changeCountryInfo(){
    if(countryData[currentSlide].name === "Korea (Democratic People's Republic of)")
    countryData[currentSlide].name === "Korea"

    setCurrentCountry(countryData[currentSlide].name);
  }
  useEffect(()=>{
    changeCountryInfo();
  },[currentSlide]);
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <img style={{opacity:`${currentSlide === 0 ? 1 : 0}`}} className={`${styles.image} ${styles.one}`} src={countryData[0].picture.landscape.link}/>
        <img style={{opacity:`${currentSlide === 1 ? 1 : 0}`}} className={`${styles.image} ${styles.two}`} src={ (countryData[1 as any] as any).picture.landscape.link}/>
        <img style={{opacity:`${currentSlide === 2 ? 1 : 0}`}} className={`${styles.image} ${styles.three}`} src={(countryData[2 as any] as any).picture.landscape.link}/>
        { /* background image for main */}
        <Navbar/>
        <div className={styles.banter}>
          <h2>ENJOY THE</h2>
          <h1>WORLD</h1>
          <button>EXPLORE NOW &#8594;</button>
        </div>
        <div className={styles.country}>
          <h2>{currentCountry}</h2>
          <ImageSlider slides = { slides } changeSlide = {setCurrentSlide}/>
        </div>
      </main>
    </>
  )
}

export async function getStaticProps(){
  const { data } = await client.query({
    query: gql`  
     query Countries {
      countries {
        name
        picture {
          portrait {
            link
        }
        landscape {
          link
        }
    }
  }
}
    `
  }) 
  return {
    props: {
      countryData:data.countries,
    },
  }
}
export default Home
